<!DOCTYPE html>
<html>
  <header>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles/weather_widget.css' %}">
    <title>SMART BOARD</title>
  </header>
  <body>
    <div class="weather">
      <p class="temperature"></p>
      <img class="icon">
      <p class="text"></p>
      <p class="humidity"></p>
      <p class="location"></p>
    </div>

    <script>
      const weather_widget_loc = window.location;
      
      const protocol_weather_widget = 'ws://';
      if (weather_widget_loc.protocol == 'https'){
        const protocol_weather_widget = 'wss://';
      }

      const weather_connection = protocol_weather_widget + weather_widget_loc.host + '/ws/weather/';
      var weather_socket = new WebSocket(weather_connection);

      weather_socket.onmessage = function (e) {
          var django_weather_data = JSON.parse(e.data);

          document.querySelector('.temperature').innerText = django_weather_data.temperature + ' Â°C';
          document.querySelector('.icon').src = django_weather_data.icon;
          document.querySelector('.text').innerText = django_weather_data.text;
          document.querySelector('.humidity').innerText = django_weather_data.humidity + ' %';
          document.querySelector('.location').innerText = django_weather_data.location;
      }
    </script>
  </body>
</html>